<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mentor Profile - VisMen</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
    }

    body {
      background: #f4f6fc;
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      background: #04367d;
      color: white;
      width: 220px;
      padding: 20px 0;
      position: fixed;
      top: 0;
      bottom: 0;
    }

    .sidebar h2 {
      text-align: center;
      margin-bottom: 30px;
    }

    .sidebar ul {
      list-style: none;
      padding-left: 0;
    }

    .sidebar ul li {
      padding: 15px 20px;
      cursor: pointer;
    }

    .sidebar ul li:hover,
    .sidebar ul li.active {
      background-color: #0d47a1;
    }

    .main-content {
      margin-left: 220px;
      padding: 40px;
      flex: 1;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 26px;
    }

    .btn-edit {
      padding: 10px 16px;
      background-color: #3654ff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .profile-section {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }

    .profile-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .profile-row div {
      flex: 1;
      margin-right: 30px;
    }

    .profile-row div:last-child {
      margin-right: 0;
    }

    .section-title {
      font-weight: bold;
      margin-top: 30px;
      margin-bottom: 10px;
    }

    .verified {
      color: #3654ff;
      font-weight: bold;
      font-size: 14px;
    }

    .download-link {
      color: #3654ff;
      text-decoration: underline;
      cursor: pointer;
    }

    footer {
      margin-top: 50px;
      padding: 10px;
      text-align: center;
      background: #04367d;
      color: white;
    }

    .profile-pic {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .profile-pic img {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      margin-right: 20px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 8px;
      width: 400px;
      position: relative;
    }

    .modal-content input,
    .modal-content textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 18px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>VISMEN</h2>
    <ul>
      <li onclick="location.href='mentor-dashboard.html'">Dashboard</li>
      <li onclick="location.href='mentor-bookings.html'">Bookings</li>
      <li onclick="location.href='mentor-earnings.html'">Earnings</li>
      <li onclick="location.href='mentor-messages.html'">Messages</li>
      <li class="active">Profile</li>
    </ul>
  </div>

  <div class="main-content">
    <div class="header">
      <h1>Account</h1>
      <button class="btn-edit" onclick="openEditModal()">Edit Profile</button>
    </div>

    <div class="profile-section">
      <div class="profile-pic">
        <img id="mentorImage" src="Mentor1.jpg" alt="Profile Photo" />
        <div>
          <h3 id="mentorName">Mentor</h3>
          <p class="verified">✔ Verified</p>
        </div>
      </div>

      <div class="profile-row">
        <div>
          <strong>Full Name</strong>
          <p id="fullName">-</p>
        </div>
        <div>
          <strong>Email</strong>
          <p id="email">-</p>
        </div>
      </div>

      <div class="profile-row">
        <div>
          <strong>Phone</strong>
          <p id="phone">-</p>
        </div>
        <div>
          <strong>Languages</strong>
          <p id="languages">-</p>
        </div>
      </div>

      <div class="section-title">Professional Details</div>
      <div class="profile-row">
        <div>
          <strong>Expertise Areas</strong>
          <p id="skills">-</p>
        </div>
        <div>
          <strong>Experience</strong>
          <p id="experience">-</p>
        </div>
      </div>
      <div>
        <strong>Bio</strong>
        <p id="bio">-</p>
      </div>
      <div style="margin-top: 10px;">
        <strong>Resume / CV</strong>
        <p><a id="resume" class="download-link" href="#">Download</a></p>
      </div>

      <div class="section-title">Security</div>
      <div class="profile-row">
        <div>
          <strong>Payout Account</strong>
          <p id="payout">-</p>
        </div>
        <div>
          <strong>Payout Frequency</strong>
          <p id="payoutFrequency">-</p>
        </div>
      </div>

      <div class="section-title">Security Options</div>
      <ul style="margin-left: 20px; line-height: 2;">
        <li>Change Password</li>
        <li>Add ZTA</li>
      </ul>

      <div class="section-title">Account Actions</div>
      <ul style="margin-left: 20px; line-height: 2;">
        <li>Download Data</li>
        <li>Clear History</li>
      </ul>
    </div>

    <footer>
      © 2025 VisMen IT Solutions. All rights reserved.
    </footer>
  </div>

  <div class="modal" id="editModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeEditModal()">&times;</span>
    <h3>Edit Mentor Profile</h3>

    <input type="text" id="inputPhone" placeholder="Phone" />
    <input type="text" id="inputLanguages" placeholder="Languages" />
    <input type="text" id="inputExpertise" placeholder="Expertise Areas" />
    <input type="text" id="inputExperience" placeholder="Experience" />
    <textarea id="inputBio" placeholder="Bio"></textarea>
    <input type="text" id="inputPayout" placeholder="Payout Account" />
    <input type="text" id="inputFrequency" placeholder="Payout Frequency" />

    <!-- 🔥 New input for available slots -->
    <label for="inputSlots">Available Slots (comma-separated)</label>
    <textarea id="inputSlots" placeholder="E.g. Mon 7:00 PM, Wed 9:30 AM, Sat 8:00 PM" rows="3"></textarea>

    <button onclick="saveProfile()">Save</button>
  </div>
</div>


  <script>
    const email = localStorage.getItem('email');
    if (!email) {
      alert("Please log in first.");
      window.location.href = "/login.html";
    }

    async function loadMentorProfile() {
      try {
        const res = await fetch(`/get-mentor-profile?email=${email}`);
        const data = await res.json();

        if (data.error) {
          alert(data.error);
          return;
        }

        document.getElementById("mentorImage").src = data.image || "/Mentor1.jpg";
        document.getElementById("mentorName").textContent = data.name || "Mentor";
        document.getElementById("fullName").textContent = data.name || "-";
        document.getElementById("email").textContent = data.email || "-";
        document.getElementById("phone").textContent = data.phone || "-";
        document.getElementById("languages").textContent = data.languages || "-";
        document.getElementById("skills").textContent = data.skills || "-";
        document.getElementById("experience").textContent = data.experience || "-";
        document.getElementById("bio").textContent = data.bio || "-";
        document.getElementById("resume").href = data.resume || "#";
        document.getElementById("payout").textContent = data.payout || "-";
        document.getElementById("payoutFrequency").textContent = data.payoutFrequency || "-";

        document.getElementById("inputPhone").value = data.phone || "";
        document.getElementById("inputLanguages").value = data.languages || "";
        document.getElementById("inputExpertise").value = data.skills || "";
        document.getElementById("inputExperience").value = data.experience || "";
        document.getElementById("inputBio").value = data.bio || "";
        document.getElementById("inputPayout").value = data.payout || "";
        document.getElementById("inputFrequency").value = data.payoutFrequency || "";
        document.getElementById("inputSlots").value = (data.slots || []).join(", ");


      } catch (err) {
        console.error("Error loading mentor profile:", err);
        alert("Failed to load profile.");
      }
    }

    function openEditModal() {
      document.getElementById('editModal').style.display = 'flex';
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
    }
async function saveProfile() {
    const email = localStorage.getItem('email');

    const payload = {
      email,
      phone: document.getElementById("inputPhone").value,
      languages: document.getElementById("inputLanguages").value,
      skills: document.getElementById("inputExpertise").value,
      experience: document.getElementById("inputExperience").value,
      bio: document.getElementById("inputBio").value,
      resume: document.getElementById("resume")?.href || "",
      payout: document.getElementById("inputPayout").value,
      payoutFrequency: document.getElementById("inputFrequency").value,
 availableSlots: document.getElementById("inputSlots").value.split(",").map(s => s.trim())    };

    try {
      const res = await fetch("/update-mentor-profile", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json(); // await must come before checking .ok

      if (!res.ok) {
        alert("❌ " + (data.error || "Update failed"));
        return;
      }

      alert("✅ " + data.message);
      document.getElementById("editModal").style.display = "none";
      loadMentorProfile();

    } catch (err) {
      console.error("Frontend error:", err);
      alert("❌ Something went wrong");
    }
  }

    window.addEventListener('DOMContentLoaded', loadMentorProfile);
  </script>
</body>
</html>

